<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <title>Force Layout Example 1</title>
    <style>
        .node {
            fill: #ccc;
            stroke: #fff;
            stroke-width: 2px;
        }

        .link {
            stroke: #777;
            stroke-width: 2px;
        }

    </style>
</head>

<style>
html, body { margin:0; padding:0; overflow:hidden }
svg { position:fixed; top:0; left:0; height:100%; width:100% }
</style>

<body>
    <div id="content">
        <svg height="100" width="100">
        </svg>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script type="module">
        let svg = d3.select('svg')
        let width = window.innerWidth;
        let height = window.innerHeight;

        let node_scale_factor = 3;
        let link_scale_factor = 1;

        let graph = {
            nodes: [
                {},
                {},
                {},
                {},
                {},
                {},
                {},
                {},
                {},
                {},
                {},
            ],
            links: [
                {source: 0, target: 1},
                {source: 0, target: 4},
                {source: 0, target: 9},
                {source: 2, target: 3},
                {source: 1, target: 2}
            ]
        };

        // Count the number of links that the nodes have; used for scaling up
        // nodes
        graph.links.forEach((link) => {
            if (!graph.nodes[link.source]["linkCount"]) graph.nodes[link.source]["linkCount"] = 0;
            if (!graph.nodes[link.target]["linkCount"]) graph.nodes[link.target]["linkCount"] = 0;
            graph.nodes[link.source]["linkCount"]++;
            graph.nodes[link.target]["linkCount"]++;
        });

        let node = svg
            .append('g')
            .selectAll('circle')
            .data(graph.nodes)
            .enter()
            .append('circle')
            .attr("r", (d) => {
                return d.linkCount ? d.linkCount * node_scale_factor : node_scale_factor
            })
            .attr('fill', (d) => {'orange'})

        let link = svg
            .append('g')
            .selectAll('line')
            .data(graph.links)
            .enter()
            .append('line')
            .attr('stroke-width', link_scale_factor)
            .style('stroke', 'pink')
            .attr("marker-end", d => `url(${new URL(`#arrow-${d.type}`, location)})`);

        let ticked = () => {
            link
                .attr('x1', (d) => d.source.x)
                .attr('y1', (d) => d.source.y)
                .attr('x2', (d) => d.target.x)
                .attr('y2', (d) => d.target.y)
            node
                .attr('cx', (d) => d.x)
                .attr('cy', (d) => d.y)
        }

        let simulation = d3.forceSimulation(graph.nodes)
            // Repulsion force
            .force("charge", d3.forceManyBody().strength(-150))
            // Attraction force
            //.force("link", d3.forceLink(graph.links).id((d) => {
                //return d.name;
            //}))
            .force("link", d3.forceLink(graph.links).strength(link_scale_factor))
            // Attraction to center
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force('collide', d3.forceCollide(d => 20))
            .force("x", d3.forceX())
            .force("y", d3.forceY())
            .on('tick', ticked);
    </script>
</body>

</html>
